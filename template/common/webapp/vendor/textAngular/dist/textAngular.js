!function(){"use strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(t,n){if(!t||""===t||v.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!e(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';v[t]=n}var n={ie:function(){for(var e,t=3,n=document.createElement("div"),a=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},a=!1;n.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,n=t.target;if(a&&null!==n){for(var r=!1,o=n;null!==o&&"html"!==o.tagName.toLowerCase()&&!r;)r="true"===o.contentEditable,o=o.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),n.focus(),n.select&&n.select())}a=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" unselectable="on" tabIndex="-1">'))}));var r=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,o=/^(ul|li|ol)$/i,l=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var i,s,d,u,c,f;if(n.ie>8||void 0===n.ie){for(var p=document.styleSheets,m=0;m<p.length;m++)if((0===p[m].media.length||p[m].media.mediaText.match(/(all|screen)/gi))&&p[m].href&&p[m].href.match(/textangular\.(min\.|)css/gi)){i=p[m];break}i||(i=function(){var e=document.createElement("style");return n.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),s=function(e,t){return u(i,e,t)},u=function(e,t,n){var a,r;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),i.rules?r=i.rules[a]:i.cssRules&&(r=i.cssRules[a]),r},f=function(e,t){var n,a;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){a=n;break}return a},d=function(e){c(i,e)},c=function(e,t){var n=e.cssRules||e.rules;if(n){var a=f(t,n);e.removeRule?e.removeRule(a):e.deleteRule(a)}}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===n.ie?"div":n.ie<=8?"P":"p":n.ie<=8?e.toUpperCase():e:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,r=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,o="",l=0;t=r.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/gi,""),a="<"+t[1].trim(),n.trim().length>0&&(a+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),a+=t[5].trim()+">",o+=e.substring(l,t.index)+a,l=t.index+t[0].length);return o+=e.substring(l),l>0?o.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize",function(e){function t(e,t){for(var n,a=0,r=0,o=/<[^>]*>/gi;n=o.exec(e);)if(r=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(r)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var a,o,l,i,s,u,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,f="",p="",m=0;o=c.exec(e);){i=o[3]||o[4];var g=new RegExp(d,"i");if(angular.isString(i)&&g.test(i)){s="";for(var h=new RegExp(d,"ig");l=h.exec(i);)for(a=0;a<r.length;a++)l[2*a+2]&&(s+="<"+r[a].tag+">");u=n(e.substring(m,o.index)),p+=f.length>0?t(u,f):u,i=i.replace(new RegExp(d,"ig"),""),p+="<"+o[1].trim(),i.length>0&&(p+=' style="'+i+'"'),p+=o[5]+">",m=o.index+o[0].length,f=s}}return p+=f.length>0?t(e.substring(m),f):e.substring(m)}function a(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",r=0;t=n.exec(e);){a+=e.substring(r,t.index),r=t.index+t[0].length;var o="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(o)?o=o.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):o+=' style="text-align:'+(t[3]||t[4])+';"',o+=">",a+=o}return a+e.substring(r)}for(var r=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],o=[],l=0;l<r.length;l++){for(var i="("+r[l].property+":\\s*(",s=0;s<r[l].values.length;s++)s>0&&(i+="|"),i+=r[l].values[s];i+=");)",o.push(i)}var d="("+o.join("|")+")";return function(t,r,o){if(!o)try{t=n(t)}catch(l){}t=a(t);var i;try{i=e(t),o&&(i=t)}catch(l){i=r||""}var s,d=i.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),u=i.replace(/(&#(9|10);)*/gi,""),c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,f=0,p=0;for(i="";null!==(s=c.exec(u))&&f<d.length;)i+=u.substring(p,s.index)+d[f],p=s.index+s[0].length,f++;return i+u.substring(p)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a,r=e.defer(),o=r.promise,l=this.$editor();try{a=this.action(r,l.startAction()),o["finally"](function(){l.endAction.call(l)})}catch(i){t.error(i)}(a||void 0===a)&&r.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var a=function(t,n){var a,r,o=t.find("li");for(r=o.length-1;r>=0;r--)a=angular.element("<"+n+">"+o[r].innerHTML+"</"+n+">"),t.after(a);t.remove(),e.setSelectionToElementEnd(a[0])},l=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},i=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),l(n.find("li")[0])},s=function(e,n,a){for(var r="",o=0;o<e.length;o++)r+="<"+t("li")+">"+e[o].innerHTML+"</"+t("li")+">";var i=angular.element("<"+a+">"+r+"</"+a+">");n.after(i),n.remove(),l(i.find("li")[0])};return function(l,d){return l=t(l),function(u,c,f,p){var m,g,h,v,y,b,E,x=angular.element("<"+l+">");try{E=e.getSelectionElement()}catch(T){}var w=angular.element(E);if(void 0!==E){var C=E.tagName.toLowerCase();if("insertorderedlist"===u.toLowerCase()||"insertunorderedlist"===u.toLowerCase()){var S=t("insertorderedlist"===u.toLowerCase()?"ol":"ul");if(C===S)return a(w,l);if("li"===C&&w.parent()[0].tagName.toLowerCase()===S&&1===w.parent().children().length)return a(w.parent(),l);if("li"===C&&w.parent()[0].tagName.toLowerCase()!==S&&1===w.parent().children().length)return i(w.parent(),S);if(C.match(r)&&!w.hasClass("ta-bind")){if("ol"===C||"ul"===C)return i(w,S);var N=!1;return angular.forEach(w.children(),function(e){e.tagName.match(r)&&(N=!0)}),N?s(w.children(),w,S):s([angular.element("<div>"+E.innerHTML+"</div>")[0]],w,S)}if(C.match(r)){if(v=e.getOnlySelectedElements(),0===v.length)g=angular.element("<"+S+"><li>"+E.innerHTML+"</li></"+S+">"),w.html(""),w.append(g);else{if(1===v.length&&("ol"===v[0].tagName.toLowerCase()||"ul"===v[0].tagName.toLowerCase()))return v[0].tagName.toLowerCase()===S?a(angular.element(v[0]),l):i(angular.element(v[0]),S);h="";var $=[];for(m=0;m<v.length;m++)if(3!==v[m].nodeType){var L=angular.element(v[m]);if("li"===v[m].tagName.toLowerCase())continue;h+="ol"===v[m].tagName.toLowerCase()||"ul"===v[m].tagName.toLowerCase()?L[0].innerHTML:"span"!==v[m].tagName.toLowerCase()||"ol"!==v[m].childNodes[0].tagName.toLowerCase()&&"ul"!==v[m].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+L[0].innerHTML+"</"+t("li")+">":L[0].childNodes[0].innerHTML,$.unshift(L)}g=angular.element("<"+S+">"+h+"</"+S+">"),$.pop().replaceWith(g),angular.forEach($,function(e){e.remove()})}return void e.setSelectionToElementEnd(g[0])}}else{if("formatblock"===u.toLowerCase()){for(b=f.toLowerCase().replace(/[<>]/gi,""),"default"===b.trim()&&(b=l,f="<"+l+">"),g="li"===C?w.parent():w;!g[0].tagName||!g[0].tagName.match(r)&&!g.parent().attr("contenteditable");)g=g.parent(),C=(g[0].tagName||"").toLowerCase();if(C===b){v=g.children();var A=!1;for(m=0;m<v.length;m++)A=A||v[m].tagName.match(r);A?(g.after(v),y=g.next(),g.remove(),g=y):(x.append(g[0].childNodes),g.after(x),g.remove(),g=x)}else if(g.parent()[0].tagName.toLowerCase()!==b||g.parent().hasClass("ta-bind"))if(C.match(o))g.wrap(f);else{for(v=e.getOnlySelectedElements(),0===v.length&&(v=[g[0]]),m=0;m<v.length;m++)if(3===v[m].nodeType||!v[m].tagName.match(r))for(;3===v[m].nodeType||!v[m].tagName||!v[m].tagName.match(r);)v[m]=v[m].parentNode;if(angular.element(v[0]).hasClass("ta-bind"))g=angular.element(f),g[0].innerHTML=v[0].innerHTML,v[0].innerHTML=g[0].outerHTML;else if("blockquote"===b){for(h="",m=0;m<v.length;m++)h+=v[m].outerHTML;for(g=angular.element(f),g[0].innerHTML=h,v[0].parentNode.insertBefore(g[0],v[0]),m=v.length-1;m>=0;m--)v[m].parentNode&&v[m].parentNode.removeChild(v[m])}else for(m=0;m<v.length;m++)g=angular.element(f),g[0].innerHTML=v[m].innerHTML,v[m].parentNode.insertBefore(g[0],v[m]),v[m].parentNode.removeChild(v[m])}else{var M=g.parent(),H=M.contents();for(m=0;m<H.length;m++)M.parent().hasClass("ta-bind")&&3===H[m].nodeType&&(x=angular.element("<"+l+">"),x[0].innerHTML=H[m].outerHTML,H[m]=x[0]),M.parent()[0].insertBefore(H[m],M[0]);M.remove()}return void e.setSelectionToElementEnd(g[0])}if("createlink"===u.toLowerCase()){var D='<a href="'+f+'" target="'+(p.a.target?p.a.target:"")+'">',k="</a>",W=e.getSelection();if(W.collapsed)e.insertHtml(D+f+k,d);else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){var B=angular.element(D+k)[0];rangy.getSelection().getRangeAt(0).surroundContents(B)}return}if("inserthtml"===u.toLowerCase())return void e.insertHtml(f,d)}}try{n[0].execCommand(u,c,f)}catch(T){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var a=t[0],o=e.rangy,i=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},s={getSelection:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:i(e.startContainer,e.startOffset),end:i(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,t.parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},getOnlySelectedElements:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return s.getSelection().container},setSelection:function(e,t,n){var a=o.createRange();a.setStart(e,t),a.setEnd(e,n),o.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!1),o.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),o.getSelection().setSingleRange(t)},insertHtml:function(e,t){var i,d,u,c,f,p,m,g=angular.element("<div>"+e+"</div>"),h=o.getSelection().getRangeAt(0),v=a.createDocumentFragment(),y=g[0].childNodes,b=!0;if(y.length>0){for(c=[],u=0;u<y.length;u++)"p"===y[u].nodeName.toLowerCase()&&""===y[u].innerHTML.trim()||3===y[u].nodeType&&""===y[u].nodeValue.trim()||(b=b&&!r.test(y[u].nodeName),c.push(y[u]));for(var E=0;E<c.length;E++)p=v.appendChild(c[E]);!b&&h.collapsed&&/^(|<br(|\/)>)$/i.test(h.startContainer.innerHTML)&&h.selectNode(h.startContainer)}else b=!0,p=v=a.createTextNode(e);if(b)h.deleteContents();else if(h.collapsed&&h.startContainer!==t)if(h.startContainer.innerHTML&&h.startContainer.innerHTML.match(/^<[^>]*>$/i))i=h.startContainer,1===h.startOffset?(h.setStartAfter(i),h.setEndAfter(i)):(h.setStartBefore(i),h.setEndBefore(i));else{if(3===h.startContainer.nodeType&&h.startContainer.parentNode!==t)for(i=h.startContainer.parentNode,d=i.cloneNode(),n.splitNodes(i.childNodes,i,d,h.startContainer,h.startOffset);!l.test(i.nodeName);){angular.element(i).after(d),i=i.parentNode;var x=d;d=i.cloneNode(),n.splitNodes(i.childNodes,i,d,x)}else i=h.startContainer,d=i.cloneNode(),n.splitNodes(i.childNodes,i,d,void 0,void 0,h.startOffset);if(angular.element(i).after(d),h.setStartAfter(i),h.setEndAfter(i),/^(|<br(|\/)>)$/i.test(i.innerHTML.trim())&&(h.setStartBefore(i),h.setEndBefore(i),angular.element(i).remove()),/^(|<br(|\/)>)$/i.test(d.innerHTML.trim())&&angular.element(d).remove(),"li"===i.nodeName.toLowerCase()){for(m=a.createDocumentFragment(),f=0;f<v.childNodes.length;f++)g=angular.element("<li>"),n.transferChildNodes(v.childNodes[f],g[0]),n.transferNodeAttributes(v.childNodes[f],g[0]),m.appendChild(g[0]);v=m,p&&(p=v.childNodes[v.childNodes.length-1],p=p.childNodes[p.childNodes.length-1])}}else h.deleteContents();h.insertNode(v),p&&s.setSelectionToElementEnd(p)}};return s}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],r=t.children();return r.length&&angular.forEach(r,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,r,o,l){if(!r&&isNaN(l))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var i=document.createDocumentFragment(),s=document.createDocumentFragment(),d=0;t.length>0&&(isNaN(l)||l!==d)&&t[0]!==r;)i.appendChild(t[0]),d++;for(!isNaN(o)&&o>=0&&t[0]&&(i.appendChild(document.createTextNode(t[0].nodeValue.substring(0,o))),t[0].nodeValue=t[0].nodeValue.substring(o));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(i,n),e.transferChildNodes(s,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=parseInt(e.$eval(n.taMaxText));if(isNaN(r))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(r=parseInt(e),isNaN(r))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=r}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=parseInt(e.$eval(n.taMinText));if(isNaN(r))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(r=parseInt(e),isNaN(r))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=r}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,r=/(^[^<]|>)[^<]/i.exec(n);return r?a=r.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),a=n.indexOf(">")),n=n.trim().substring(a,a+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:/>\s*[^\s<]/i.test(n)||e.test(n)?!1:!0}}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(e,t,o,i,u,c,f,p,m,h,v,y,b){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(c,E,x,T){var w,C,S,N,$=T[0],L=T[1]||{},A=void 0!==E.attr("contenteditable")&&E.attr("contenteditable"),M=A||"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase(),H=!1,D=!1,k=!1,W=x.taUnsafeSanitizer||h.disableSanitizer,B=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,_=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===x.taDefaultWrap&&(x.taDefaultWrap="p"),""===x.taDefaultWrap?(S="",N=void 0===n.ie?"<div><br></div>":n.ie>=11?"<p><br></p>":n.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(S=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+"></"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+"></"+x.taDefaultWrap+">",N=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+">&nbsp;</"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+">&nbsp;</"+x.taDefaultWrap+">"),L.$options||(L.$options={});var R=v(N),z=function(e){if(R(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+x.taDefaultWrap+">"+e+"</"+x.taDefaultWrap+">";else{var n,a=t[0].childNodes,o=!1;for(n=0;n<a.length&&!(o=a[n].nodeName.toLowerCase().match(r));n++);if(o)for(e="",n=0;n<a.length;n++)if(a[n].nodeName.toLowerCase().match(r))e+=a[n].outerHTML;else{var l=a[n].outerHTML||a[n].nodeValue;e+=""!==l.trim()?"<"+x.taDefaultWrap+">"+l+"</"+x.taDefaultWrap+">":l}else e="<"+x.taDefaultWrap+">"+e+"</"+x.taDefaultWrap+">"}return e};x.taPaste&&(C=y(x.taPaste)),E.addClass("ta-bind");var O;c["$undoManager"+(x.id||"")]=$.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),O&&t.cancel(O),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var q,I=c["$undoTaBind"+(x.id||"")]=function(){if(!H&&A){var e=$.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(ne(e),U(e,!1),q&&t.cancel(q),q=t(function(){E[0].focus(),f.setSelectionToElementEnd(E[0])},1))}},V=c["$redoTaBind"+(x.id||"")]=function(){if(!H&&A){var e=$.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(ne(e),U(e,!1),q&&t.cancel(q),q=t(function(){E[0].focus(),f.setSelectionToElementEnd(E[0])},1))}},F=function(){if(A)return E[0].innerHTML;if(M)return E.val();throw"textAngular Error: attempting to update non-editable taBind"},U=function(e,t,n){k=n||!1,("undefined"==typeof t||null===t)&&(t=A),("undefined"==typeof e||null===e)&&(e=F()),R(e)?(""!==$.$viewValue&&$.$setViewValue(""),t&&""!==$.$undoManager.current()&&$.$undoManager.push("")):(te(),$.$viewValue!==e&&($.$setViewValue(e),t&&$.$undoManager.push(e))),$.$render()};c["updateTaBind"+(x.id||"")]=function(){H||U(void 0,void 0,!0)};var P=function(t){return $.$oldViewValue=e(u(t),$.$oldViewValue,W)};if(E.attr("required")&&($.$validators.required=function(e,t){return!R(e||t)}),$.$parsers.push(P),$.$parsers.unshift(z),$.$formatters.push(P),$.$formatters.unshift(z),$.$formatters.unshift(function(e){return $.$undoManager.push(e||"")}),M)if(c.events={},A){var K=!1,G=function(n){if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){var a=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=a?a[1]:n,a=a.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var r=angular.element("<div>"+a+"</div>"),o=angular.element("<div></div>"),l={element:null,lastIndent:[],lastLi:null,isUl:!1};l.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var i=function(e){l.isUl=e,l.element=angular.element(e?"<ul>":"<ol>"),l.lastIndent=[],l.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},l.lastLevelMatch=null},s=0;s<=r[0].childNodes.length;s++)if(r[0].childNodes[s]&&"#text"!==r[0].childNodes[s].nodeName&&"p"===r[0].childNodes[s].tagName.toLowerCase()){var d=angular.element(r[0].childNodes[s]),u=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(u){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)continue;var p="bullet"===u[1].toLowerCase()||"number"!==u[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),m=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),g=parseFloat(m?m[1]:0),h=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(h&&h[2]&&(g=parseInt(h[2])),h&&(!l.lastLevelMatch||h[1]!==l.lastLevelMatch[1])||!u[3]||"first"===u[3].toLowerCase()||null===l.lastIndent.peek()||l.isUl!==p&&l.lastIndent.peek()===g)i(p),o.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()<g)l.element=angular.element(p?"<ul>":"<ol>"),l.lastLi.append(l.element);else if(null!=l.lastIndent.peek()&&l.lastIndent.peek()>g){for(;null!=l.lastIndent.peek()&&l.lastIndent.peek()>g;)if("li"!==l.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(l.element.parent()[0].tagName.toLowerCase()))break;l.element=l.element.parent(),l.lastIndent.pop()}else l.element=l.element.parent();l.isUl="ul"===l.element[0].tagName.toLowerCase(),p!==l.isUl&&(i(p),o.append(l.element))}l.lastLevelMatch=h,g!==l.lastIndent.peek()&&l.lastIndent.push(g),l.lastLi=angular.element("<li>"),l.element.append(l.lastLi),l.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}else i(!1),o.append(d)}var v=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(o.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&v(e)}),angular.forEach(o.find("font"),v),n=o.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var y=angular.element("<div>"+n+"</div>");y.find("textarea").remove();for(var x=b.getByAttribute(y,"ta-bind"),T=0;T<x.length;T++){for(var w=x[T][0].parentNode.parentNode,S=0;S<x[T][0].childNodes.length;S++)w.parentNode.insertBefore(x[T][0].childNodes[S],w);w.parentNode.removeChild(w)}n=y.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/gi,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(n)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(n)===!1&&(n=n.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),C&&(n=C(c,{$html:n})||n),n=e(n,"",W),f.insertHtml(n,E[0]),t(function(){$.$setViewValue(F()),K=!1,E.removeClass("processing-paste")},0)}else K=!1,E.removeClass("processing-paste")};E.on("paste",c.events.paste=function(e,n){if(n&&angular.extend(e,n),H||K)return e.stopPropagation(),e.preventDefault(),!1;K=!0,E.addClass("processing-paste");var a,r=(e.originalEvent||e).clipboardData;if(r&&r.getData&&r.types.length>0){for(var l="",s=0;s<r.types.length;s++)l+=" "+r.types[s];return/text\/html/i.test(l)?a=r.getData("text/html"):/text\/plain/i.test(l)&&(a=r.getData("text/plain")),G(a),e.stopPropagation(),e.preventDefault(),!1}var d=o.rangy.saveSelection(),u=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');i.find("body").append(u),u[0].focus(),t(function(){o.rangy.restoreSelection(d),G(u[0].innerHTML),E[0].focus(),u.remove()},0)}),E.on("cut",c.events.cut=function(e){H?e.preventDefault():t(function(){$.$setViewValue(F())},0)}),E.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),!H)if(e.altKey||!e.metaKey&&!e.ctrlKey){if(13===e.keyCode&&!e.shiftKey){var n,a=f.getSelectionElement();if(!a.tagName.match(l))return;var r=angular.element(S);if(/^<br(|\/)>$/i.test(a.innerHTML.trim())&&"blockquote"===a.parentNode.tagName.toLowerCase()&&!a.nextSibling){n=angular.element(a);var o=n.parent();o.after(r),n.remove(),0===o.children().length&&o.remove(),f.setSelectionToElementStart(r[0]),e.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(a.innerHTML.trim())&&"blockquote"===a.tagName.toLowerCase()&&(n=angular.element(a),n.after(r),n.remove(),f.setSelectionToElementStart(r[0]),e.preventDefault())}}else 90!==e.keyCode||e.shiftKey?(90===e.keyCode&&e.shiftKey||89===e.keyCode&&!e.shiftKey)&&(V(),e.preventDefault()):(I(),e.preventDefault())});var j;if(E.on("keyup",c.events.keyup=function(e,n){if(n&&angular.extend(e,n),9===e.keyCode){var a=f.getSelection();return void(a.start.element===E[0]&&E.children().length&&f.setSelectionToElementStart(E.children()[0]))}if(O&&t.cancel(O),!H&&!B.test(e.keyCode)){if(""!==S&&13===e.keyCode&&!e.shiftKey){for(var r=f.getSelectionElement();!r.tagName.match(l)&&r!==E[0];)r=r.parentNode;if(r.tagName.toLowerCase()!==x.taDefaultWrap&&"li"!==r.tagName.toLowerCase()&&(""===r.innerHTML.trim()||"<br>"===r.innerHTML.trim())){var i=angular.element(S);angular.element(r).replaceWith(i),f.setSelectionToElementStart(i[0])}}var s=F();if(""!==S&&""===s.trim())ne(S),f.setSelectionToElementStart(E.children()[0]);else if("<"!==s.substring(0,1)&&""!==x.taDefaultWrap){var d=o.rangy.saveSelection();s=F(),s="<"+x.taDefaultWrap+">"+s+"</"+x.taDefaultWrap+">",ne(s),o.rangy.restoreSelection(d)}var u=w!==e.keyCode&&_.test(e.keyCode);j&&t.cancel(j),j=t(function(){U(s,u,!0)},L.$options.debounce||400),u||(O=t(function(){$.$undoManager.push(s)},250)),w=e.keyCode}}),E.on("blur",c.events.blur=function(){D=!1,H?(k=!0,$.$render()):U(void 0,void 0,!0)}),x.placeholder&&(n.ie>8||void 0===n.ie)){var X;if(!x.id)throw"textAngular Error: An unique ID is required for placeholders to work";X=s("#"+x.id+".placeholder-text:before",'content: "'+x.placeholder+'"'),c.$on("$destroy",function(){d(X)})}E.on("focus",c.events.focus=function(){D=!0,E.removeClass("placeholder-text")}),E.on("mouseup",c.events.mouseup=function(){var e=f.getSelection();e.start.element===E[0]&&E.children().length&&f.setSelectionToElementStart(E.children()[0])}),E.on("mousedown",c.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{E.on("change blur",c.events.change=c.events.blur=function(){H||$.$setViewValue(F())}),E.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,r=E.val();if(e.shiftKey){var o=r.lastIndexOf("\n",n),l=r.lastIndexOf("	",n);-1!==l&&l>=o&&(E.val(r.substring(0,l)+r.substring(l+1)),this.selectionStart=this.selectionEnd=n-1)}else E.val(r.substring(0,n)+"	"+r.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var Y=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},J=function(e,t){var n="",a=e.childNodes;t++,n+=Y("	",t-1)+e.outerHTML.substring(0,e.outerHTML.indexOf("<li"));for(var r=0;r<a.length;r++)a[r].outerHTML&&(n+="ul"===a[r].nodeName.toLowerCase()||"ol"===a[r].nodeName.toLowerCase()?"\n"+J(a[r],t):"\n"+Y("	",t)+a[r].outerHTML);return n+="\n"+Y("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};$.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;if(t.length>0){e="";for(var n=0;n<t.length;n++)t[n].outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===t[n].nodeName.toLowerCase()||"ol"===t[n].nodeName.toLowerCase()?""+J(t[n],0):""+t[n].outerHTML)}return e})}var Q,Z=function(e){return c.$emit("ta-element-select",this),e.preventDefault(),!1},ee=function(e,n){if(n&&angular.extend(e,n),!g&&!H){g=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,c.$emit("ta-drop-event",this,e,a),t(function(){g=!1,U(void 0,void 0,!0)},100)}},te=c["reApplyOnSelectorHandlers"+(x.id||"")]=function(){H||angular.forEach(p,function(e){E.find(e).off("click",Z).on("click",Z)})},ne=function(e){E[0].innerHTML=e},ae=!1;$.$render=function(){if(!ae){ae=!0;var e=$.$viewValue||"";k||(A&&D&&(E.removeClass("placeholder-text"),Q&&t.cancel(Q),Q=t(function(){D||(E[0].focus(),f.setSelectionToElementEnd(E.children()[E.children().length-1])),Q=void 0},1)),A?(ne(x.placeholder?""===e?S:e:""===e?S:e),H?E.off("drop",ee):(te(),E.on("drop",ee))):"textarea"!==E[0].tagName.toLowerCase()&&"input"!==E[0].tagName.toLowerCase()?ne(m(e)):E.val(e)),A&&x.placeholder&&(""===e?D?E.removeClass("placeholder-text"):E.addClass("placeholder-text"):E.removeClass("placeholder-text")),ae=k=!1}},x.taReadonly&&(H=c.$eval(x.taReadonly),H?(E.addClass("ta-readonly"),("textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase())&&E.attr("disabled","disabled"),void 0!==E.attr("contenteditable")&&E.attr("contenteditable")&&E.removeAttr("contenteditable")):(E.removeClass("ta-readonly"),"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase()?E.removeAttr("disabled"):A&&E.attr("contenteditable","true")),c.$watch(x.taReadonly,function(e,t){t!==e&&(e?(E.addClass("ta-readonly"),("textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase())&&E.attr("disabled","disabled"),void 0!==E.attr("contenteditable")&&E.attr("contenteditable")&&E.removeAttr("contenteditable"),angular.forEach(p,function(e){E.find(e).on("click",Z)}),E.off("drop",ee)):(E.removeClass("ta-readonly"),"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase()?E.removeAttr("disabled"):A&&E.attr("contenteditable","true"),angular.forEach(p,function(e){E.find(e).off("click",Z)}),E.on("drop",ee)),H=e)})),A&&!H&&(angular.forEach(p,function(e){E.find(e).on("click",Z)}),E.on("drop",ee),E.on("blur",function(){n.webkit&&(a=!0)}))}}}]);var g=!1,h=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),v={};h.constant("taRegisterTool",t),h.value("taTools",v),h.config([function(){angular.forEach(v,function(e,t){delete v[t]})}]),h.run([function(){if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}]),h.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,a,r,o,l,i,s,d,u,c){return{require:"?ngModel",scope:{},
restrict:"EA",priority:2,link:function(f,p,m,g){var h,v,y,b,E,x,T,w,C,S,N,$=m.serial?m.serial:Math.floor(1e16*Math.random());f._name=m.name?m.name:"textAngularEditor"+$;var L=function(e,n,a){t(function(){var t=function(){e.off(n,t),a.apply(this,arguments)};e.on(n,t)},100)};if(C=r(m.taDefaultWrap),angular.extend(f,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?f["$undoTaBindtaTextElement"+$]():"redo"===e.toLowerCase()?f["$redoTaBindtaTextElement"+$]():(C(e,!1,t,f.defaultTagAttributes),n&&f["reApplyOnSelectorHandlerstaTextElement"+$](),f.displayElements.text[0].focus())},showHtml:f.$eval(m.taShowHtml)||!1}),m.taFocussedClass&&(f.classes.focussed=m.taFocussedClass),m.taTextEditorClass&&(f.classes.textEditor=m.taTextEditorClass),m.taHtmlEditorClass&&(f.classes.htmlEditor=m.taHtmlEditorClass),m.taDefaultTagAttributes)try{angular.extend(f.defaultTagAttributes,angular.fromJson(m.taDefaultTagAttributes))}catch(A){d.error(A)}m.taTextEditorSetup&&(f.setup.textEditorSetup=f.$parent.$eval(m.taTextEditorSetup)),m.taHtmlEditorSetup&&(f.setup.htmlEditorSetup=f.$parent.$eval(m.taHtmlEditorSetup)),m.taFileDrop?f.fileDropHandler=f.$parent.$eval(m.taFileDrop):f.fileDropHandler=f.defaultFileDropHandler,T=p[0].innerHTML,p[0].innerHTML="",f.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},f.displayElements.popover.append(f.displayElements.popoverArrow),f.displayElements.popover.append(f.displayElements.popoverContainer),f.displayElements.scrollWindow.append(f.displayElements.popover),f.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),f.showPopover=function(e){f.displayElements.popover.css("display","block"),f.reflowPopover(e),s.addClass(f.displayElements.popover,"in"),L(i.find("body"),"click keyup",function(){f.hidePopover()})},f.reflowPopover=function(e){f.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(f.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+f.displayElements.scrollWindow[0].scrollTop+"px"),f.displayElements.popover.removeClass("top").addClass("bottom")):(f.displayElements.popover.css("top",e[0].offsetTop-54+f.displayElements.scrollWindow[0].scrollTop+"px"),f.displayElements.popover.removeClass("bottom").addClass("top"));var t=f.displayElements.text[0].offsetWidth-f.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-f.displayElements.popover[0].offsetWidth/2;f.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),f.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},f.hidePopover=function(){var e=function(){f.displayElements.popover.css("display",""),f.displayElements.popoverContainer.attr("style",""),f.displayElements.popoverContainer.attr("class","popover-content")};u.when(s.removeClass(f.displayElements.popover,"in",e)).then(e)},f.displayElements.resize.overlay.append(f.displayElements.resize.background),angular.forEach(f.displayElements.resize.anchors,function(e){f.displayElements.resize.overlay.append(e)}),f.displayElements.resize.overlay.append(f.displayElements.resize.info),f.displayElements.scrollWindow.append(f.displayElements.resize.overlay),f.reflowResizeOverlay=function(e){e=angular.element(e)[0],f.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),f.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},f.showResizeOverlay=function(e){var t=i.find("body");S=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),f.hidePopover();var r=a.height/a.width,o=function(t){var n={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))};if(t.shiftKey){var o=n.y/n.x;n.x=r>o?n.x:n.y/r,n.y=r>o?n.x*r:n.y}var l=angular.element(e);l.attr("height",Math.max(0,n.y)),l.attr("width",Math.max(0,n.x)),f.reflowResizeOverlay(e)};t.on("mousemove",o),L(t,"mouseup",function(n){n.preventDefault(),n.stopPropagation(),t.off("mousemove",o),f.showPopover(e)}),n.stopPropagation(),n.preventDefault()},f.displayElements.resize.anchors[3].on("mousedown",S),f.reflowResizeOverlay(e),L(t,"click",function(){f.hideResizeOverlay()})},f.hideResizeOverlay=function(){f.displayElements.resize.anchors[3].off("mousedown",S),f.displayElements.resize.overlay.css("display","")},f.setup.htmlEditorSetup(f.displayElements.html),f.setup.textEditorSetup(f.displayElements.text),f.displayElements.html.attr({id:"taHtmlElement"+$,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":p.attr("ng-model-options")}),f.displayElements.text.attr({id:"taTextElement"+$,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":p.attr("ng-model-options")}),f.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),m.taDefaultWrap&&f.displayElements.text.attr("ta-default-wrap",m.taDefaultWrap),m.taUnsafeSanitizer&&(f.displayElements.text.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer),f.displayElements.html.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer)),f.displayElements.scrollWindow.append(f.displayElements.text),p.append(f.displayElements.scrollWindow),p.append(f.displayElements.html),f.displayElements.forminput.attr("name",f._name),p.append(f.displayElements.forminput),m.tabindex&&(p.removeAttr("tabindex"),f.displayElements.text.attr("tabindex",m.tabindex),f.displayElements.html.attr("tabindex",m.tabindex)),m.placeholder&&(f.displayElements.text.attr("placeholder",m.placeholder),f.displayElements.html.attr("placeholder",m.placeholder)),m.taDisabled&&(f.displayElements.text.attr("ta-readonly","disabled"),f.displayElements.html.attr("ta-readonly","disabled"),f.disabled=f.$parent.$eval(m.taDisabled),f.$parent.$watch(m.taDisabled,function(e){f.disabled=e,f.disabled?p.addClass(f.classes.disabled):p.removeClass(f.classes.disabled)})),m.taPaste&&(f._pasteHandler=function(e){return c(m.taPaste)(f.$parent,{$html:e})},f.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(f.displayElements.scrollWindow)(f),e(f.displayElements.html)(f),f.updateTaBindtaTextElement=f["updateTaBindtaTextElement"+$],f.updateTaBindtaHtmlElement=f["updateTaBindtaHtmlElement"+$],p.addClass("ta-root"),f.displayElements.scrollWindow.addClass("ta-text ta-editor "+f.classes.textEditor),f.displayElements.html.addClass("ta-html ta-editor "+f.classes.htmlEditor),f._actionRunning=!1;var M=!1;if(f.startAction=function(){return f._actionRunning=!0,M=l.rangy.saveSelection(),function(){M&&l.rangy.restoreSelection(M)}},f.endAction=function(){f._actionRunning=!1,M&&(f.showHtml?f.displayElements.html[0].focus():f.displayElements.text[0].focus(),l.rangy.restoreSelection(M),l.rangy.removeMarkers(M)),M=!1,f.updateSelectedStyles(),f.showHtml||f["updateTaBindtaTextElement"+$]()},E=function(){f.focussed=!0,p.addClass(f.classes.focussed),w.focus(),p.triggerHandler("focus")},f.displayElements.html.on("focus",E),f.displayElements.text.on("focus",E),x=function(e){return f._actionRunning||i[0].activeElement===f.displayElements.html[0]||i[0].activeElement===f.displayElements.text[0]||(p.removeClass(f.classes.focussed),w.unfocus(),t(function(){f._bUpdateSelectedStyles=!1,p.triggerHandler("blur"),f.focussed=!1},0)),e.preventDefault(),!1},f.displayElements.html.on("blur",x),f.displayElements.text.on("blur",x),f.displayElements.text.on("paste",function(e){p.triggerHandler("paste",e)}),f.queryFormatBlockState=function(e){return!f.showHtml&&e.toLowerCase()===i[0].queryCommandValue("formatBlock").toLowerCase()},f.queryCommandState=function(e){return f.showHtml?"":i[0].queryCommandState(e)},f.switchView=function(){f.showHtml=!f.showHtml,s.enabled(!1,f.displayElements.html),s.enabled(!1,f.displayElements.text),f.showHtml?t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.text[0].focus()},100)},m.ngModel){var H=!0;g.$render=function(){if(H){H=!1;var e=f.$parent.$eval(m.ngModel);void 0!==e&&null!==e||!T||""===T||g.$setViewValue(T)}f.displayElements.forminput.val(g.$viewValue),f.html=g.$viewValue||""},p.attr("required")&&(g.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})}else f.displayElements.forminput.val(T),f.html=T;if(f.$watch("html",function(e,t){e!==t&&(m.ngModel&&g.$viewValue!==e&&g.$setViewValue(e),f.displayElements.forminput.val(e))}),m.taTargetToolbars)w=o.registerEditor(f._name,f,m.taTargetToolbars.split(","));else{var D=angular.element('<div text-angular-toolbar name="textAngularToolbar'+$+'">');m.taToolbar&&D.attr("ta-toolbar",m.taToolbar),m.taToolbarClass&&D.attr("ta-toolbar-class",m.taToolbarClass),m.taToolbarGroupClass&&D.attr("ta-toolbar-group-class",m.taToolbarGroupClass),m.taToolbarButtonClass&&D.attr("ta-toolbar-button-class",m.taToolbarButtonClass),m.taToolbarActiveButtonClass&&D.attr("ta-toolbar-active-button-class",m.taToolbarActiveButtonClass),m.taFocussedClass&&D.attr("ta-focussed-class",m.taFocussedClass),p.prepend(D),e(D)(f.$parent),w=o.registerEditor(f._name,f,["textAngularToolbar"+$])}f.$on("$destroy",function(){o.unregisterEditor(f._name)}),f.$on("ta-element-select",function(e,t){w.triggerElementSelect(e,t)&&f["reApplyOnSelectorHandlerstaTextElement"+$]()}),f.$on("ta-drop-event",function(e,n,a,r){f.displayElements.text[0].focus(),r&&r.files&&r.files.length>0?(angular.forEach(r.files,function(e){try{u.when(f.fileDropHandler(e,f.wrapSelection)||f.fileDropHandler!==f.defaultFileDropHandler&&u.when(f.defaultFileDropHandler(e,f.wrapSelection))).then(function(){f["updateTaBindtaTextElement"+$]()})}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation()):t(function(){f["updateTaBindtaTextElement"+$]()},0)}),f._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){f._bUpdateSelectedStyles=!1,f.focussed=!1}),f.updateSelectedStyles=function(){var e;N&&t.cancel(N),void 0!==(e=a.getSelectionElement())&&e.parentNode!==f.displayElements.text[0]?w.updateSelectedStyles(angular.element(e)):w.updateSelectedStyles(),f._bUpdateSelectedStyles&&(N=t(f.updateSelectedStyles,200))},h=function(){return f.focussed?void(f._bUpdateSelectedStyles||(f._bUpdateSelectedStyles=!0,f.$apply(function(){f.updateSelectedStyles()}))):void(f._bUpdateSelectedStyles=!1)},f.displayElements.html.on("keydown",h),f.displayElements.text.on("keydown",h),v=function(){f._bUpdateSelectedStyles=!1},f.displayElements.html.on("keyup",v),f.displayElements.text.on("keyup",v),y=function(e,t){t&&angular.extend(e,t),f.$apply(function(){return w.sendKeyCommand(e)?(f._bUpdateSelectedStyles||f.updateSelectedStyles(),e.preventDefault(),!1):void 0})},f.displayElements.html.on("keypress",y),f.displayElements.text.on("keypress",y),b=function(){f._bUpdateSelectedStyles=!1,f.$apply(function(){f.updateSelectedStyles()})},f.displayElements.html.on("mouseup",b),f.displayElements.text.on("mouseup",b)}}}]),h.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var a={},r={};return{registerEditor:function(n,o,l){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(r[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var i=[];return angular.forEach(l,function(e){a[e]&&i.push(a[e])}),r[n]={scope:o,toolbars:l,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&i.push(e)},editorFunctions:{disable:function(){angular.forEach(i,function(e){e.disabled=!0})},enable:function(){angular.forEach(i,function(e){e.disabled=!1})},focus:function(){angular.forEach(i,function(e){e._parent=o,e.disabled=!1,e.focussed=!0,o.focussed=!0})},unfocus:function(){angular.forEach(i,function(e){e.disabled=!0,e.focussed=!1}),o.focussed=!1},updateSelectedStyles:function(e){angular.forEach(i,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=o,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var a=!1;return(n.ctrlKey||n.metaKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&t.commandKeyCode===n.which)for(var l=0;l<i.length;l++)if(void 0!==i[l].tools[r]){e.call(i[l].tools[r],o),a=!0;break}}),a},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},r=[],l={},s=!1;n=angular.element(n);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||a(n,e.onElementSelect.onlyWithAttrs))&&(l[t]=e))}),d?(angular.forEach(l,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(l,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var u=0;u<r.length;u++){for(var c=r[u].tool,f=r[u].name,p=0;p<i.length;p++)if(void 0!==i[p].tools[f]){c.onElementSelect.action.call(i[p].tools[f],e,n,o),s=!0;break}if(s)break}return s}}},r[n].editorFunctions},retrieveEditor:function(e){return r[e]},unregisterEditor:function(e){delete r[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(a[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';a[e.name]=e,angular.forEach(r,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return a[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete a[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(a,function(a,r){n.updateToolbarToolDisplay(r,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(a,function(n,a){t.resetToolbarToolDisplay(a,e)})},updateToolbarToolDisplay:function(e,t,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(a,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,r=0;r<t.toolbar[n].length;r++){if(t.toolbar[n][r]===e){a={group:n,index:r};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}})},addTool:function(e,t,r,o){n(e,t),angular.forEach(a,function(n){n.addTool(e,t,r,o)})},addToolToToolbar:function(e,t,r,o,l){n(e,t),a[r].addTool(e,t,o,l)},refreshEditor:function(e){if(!r[e])throw'textAngular Error: No Editor with name "'+e+'" exists';r[e].scope.updateTaBindtaTextElement(),r[e].scope.$$phase||r[e].scope.$digest()}}}]),h.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,r,o){return{scope:{name:"@"},restrict:"EA",link:function(l,i,s){if(!l.name||""===l.name)throw"textAngular Error: A toolbar requires a name";angular.extend(l,angular.copy(n)),s.taToolbar&&(l.toolbar=l.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(l.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(l.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(l.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(l.classes.focussed=s.taFocussedClass),l.disabled=!0,l.focussed=!1,l._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+l.classes.toolbar),l.$watch("focussed",function(){l.focussed?i.addClass(l.classes.focussed):i.removeClass(l.classes.focussed)});var d=function(t,n){var a;if(a=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?a.addClass(t["class"]):a.addClass(l.classes.toolbarButton),a.attr("name",n.name),a.attr("ta-button","ta-button"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var r=angular.element("<i>"),o=a[0].innerHTML;r.addClass(t.iconclass),a[0].innerHTML="",a.append(r),o&&""!==o&&a.append("&nbsp;"+o)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};l.tools={},l._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var u={$window:o,$editor:function(){return l._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?l.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(l.toolbar,function(e){var t=angular.element("<div>");t.addClass(l.classes.toolbarGroup),angular.forEach(e,function(e){l.tools[e]=angular.extend(l.$new(!0),a[e],u,{name:e}),l.tools[e].$element=d(a[e],l.tools[e]),t.append(l.tools[e].$element)}),i.append(t)}),l.updateToolDisplay=function(e,t,n){var a=l.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=d(t,a);a.$element.replaceWith(r),a.$element=r}},l.addTool=function(e,t,n,r){l.tools[e]=angular.extend(l.$new(!0),a[e],u,{name:e}),l.tools[e].$element=d(a[e],l.tools[e]);var o;void 0===n&&(n=l.toolbar.length-1),o=angular.element(i.children()[n]),void 0===r?(o.append(l.tools[e].$element),l.toolbar[n][l.toolbar[n].length-1]=e):(o.children().eq(r).after(l.tools[e].$element),l.toolbar[n][r]=e)},t.registerToolbar(l),l.$on("$destroy",function(){t.unregisterToolbar(l.name)})}}}])}();